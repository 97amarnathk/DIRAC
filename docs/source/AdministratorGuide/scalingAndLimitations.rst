===========
Limitations
===========


DataManagement
==============

----------
LFN length
----------

Because they are stored in a database, the LFNs are limited in size. The standard size is 255 characters. It is enforced in the following database:

* JobDB
* TransformationTB
* StorageManagementDB
* DataIntegrityDB
* FTS3DB
* RequestDB

Shall you want to have longer LFN, then you would need to update your database manually.

A special case is the DFC. The limitations depend on the Directory and File managers you use.

In the DirectoryLevelTree and FileManager (defaults one) managers, the LFNs are split by '/', yielding other limitations:

* 128 char for the filename
* 255 char for each directory level

In case of the Managers WithPkAndPs (LHCb):

* 128 char for the filename
* 255 for the base path



=======
Scaling
=======


Servers
=======

When you servers are heavily loaded, you may want to tune some kernel parameters. Internet is full or resources to explain you what you should do, but a few parameters of interests certainly are the number of file descriptors allowed, as well as a few kernel tcp parameters that should be increased (https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt)::

   net.nf_conntrack_max
   net.ipv4.tcp_max_syn_backlog
   net.core.somaxconn
   net.core.netdev_max_backlog


Finally, the parameter `SocketBacklog` for a service can be increased (`man listen` is your friend).


Duplications
============

In some cases, it is possible to run several instances of the same agent/service in order to scale.

Services
========
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| **System**         | **Component**                                                                                     |**Duplicate**| **Remarque**                                                                        |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| Accounting         | :mod:`DataStore <DIRAC.AccountingSystem.Service.DataStoreHandler>`                                | PARTIAL     |One master and helpers (See :ref:`datastorehelpers`)                                 |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`ReportGenerator <DIRAC.AccountingSystem.Service.ReportGeneratorHandler>`                    |             |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| Configuration      | :mod:`Configuration <DIRAC.ConfigurationSystem.Service.ConfigurationHandler>`                     | PARTIAL     |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| DataManagement     | :mod:`DataIntegrity <DIRAC.DataManagementSystem.Service.DataIntegrityHandler>`                    | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`FileCatalog <DIRAC.DataManagementSystem.Service.FileCatalogHandler>`                        | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`FileCatalogProxy <DIRAC.DataManagementSystem.Service.FileCatalogProxyHandler>`              |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`FTS3Manager <DIRAC.DataManagementSystem.Service.FTS3ManagerHandler>`                        | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`IRODSStorageElement <DIRAC.DataManagementSystem.Service.IRODSStorageElementHandler>`        |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`StorageElement <DIRAC.DataManagementSystem.Service.StorageElementHandler>`                  |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`StorageElementProxy <DIRAC.DataManagementSystem.Service.StorageElementProxyHandler>`        |             |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| Framework          | :mod:`BundleDelivery <DIRAC.FrameworkSystem.Service.BundleDeliveryHandler>`                       |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`ComponentMonitoring <DIRAC.FrameworkSystem.Service.ComponentMonitoringHandler>`             |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`Monitoring <DIRAC.FrameworkSystem.Service.MonitoringHandler>`                               |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`Notification <DIRAC.FrameworkSystem.Service.NotificationHandler>`                           |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`Plotting <DIRAC.FrameworkSystem.Service.PlottingHandler>`                                   |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`ProxyManager <DIRAC.FrameworkSystem.Service.ProxyManagerHandler>`                           | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`RabbitMQSync <DIRAC.FrameworkSystem.Service.RabbitMQSyncHandler>`                           |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`SecurityLogging <DIRAC.FrameworkSystem.Service.SecurityLoggingHandler>`                     | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`SystemAdministrator <DIRAC.FrameworkSystem.Service.SystemAdministratorHandler>`             | YES         | In principle there should be one on each and every machine                          |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`SystemLogging <DIRAC.FrameworkSystem.Service.SystemLoggingHandler>`                         |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`SystemLoggingReport <DIRAC.FrameworkSystem.Service.SystemLoggingReportHandler>`             |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`UserProfileManager <DIRAC.FrameworkSystem.Service.UserProfileManagerHandler>`               |             |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| Monitoring         | :mod:`Monitoring <DIRAC.MonitoringSystem.Service.MonitoringHandler>`                              |             |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| RequestManagement  | :mod:`ReqManager <DIRAC.RequestManagementSystem.Service.ReqManagerHandler>`                       | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`ReqProxy <DIRAC.RequestManagementSystem.Service.ReqProxyHandler>`                           | YES         |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| ResourcesStatus    | :mod:`Publisher <DIRAC.ResourceStatusSystem.Service.PublisherHandler>`                            |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`ResourceManagement <DIRAC.ResourceStatusSystem.Service.ResourceManagementHandler>`          |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`ResourceStatus <DIRAC.ResourceStatusSystem.Service.ResourceStatusHandler>`                  |             |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| StorageManager     | :mod:`StorageManager <DIRAC.StorageManagementSystem.Service.StorageManagerHandler>`               |             |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| Transformation     | :mod:`TransformationManager <DIRAC.TransformationSystem.Service.TransformationManagerHandler>`    |             |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
| WorkloadManagement | :mod:`JobManager <DIRAC.WorkloadManagementSystem.Service.JobManagerHandler>`                      | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`JobMonitoring <DIRAC.WorkloadManagementSystem.Service.JobMonitoringHandler>`                | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`JobStateUpdate <DIRAC.WorkloadManagementSystem.Service.JobStateUpdateHandler>`              | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`Matcher <DIRAC.WorkloadManagementSystem.Service.MatcherHandler>`                            | **NO**      |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`OptimizationMind <DIRAC.WorkloadManagementSystem.Service.OptimizationMindHandler>`          |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`PilotManager <DIRAC.WorkloadManagementSystem.Service.PilotManagerHandler>`                  | YES         |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`SandboxStore <DIRAC.WorkloadManagementSystem.Service.SandboxStoreHandler>`                  |             |                                                                                     |
+                    +---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+
|                    | :mod:`WMSAdministrator <DIRAC.WorkloadManagementSystem.Service.WMSAdministratorHandler>`          |             |                                                                                     |
+--------------------+---------------------------------------------------------------------------------------------------+-------------+-------------------------------------------------------------------------------------+


Agents
======

+--------------------+-----------------------------+-----------+------------+
| System             | Component                   | Duplicate | Remarque   |
+--------------------+-----------------------------+-----------+------------+
| Accounting         | NetworkAgent                |           |            |
+--------------------+-----------------------------+-----------+------------+
|                    | Test_NetworkAgent           |           |            |
+--------------------+-----------------------------+-----------+------------+
| Configuration      | Bdii2CSAgent                |           |            |
+                    +-----------------------------+-----------+------------+
|                    | GOCDB2CSAgent               |           |            |
+                    +-----------------------------+-----------+------------+
|                    | VOMS2CSAgent                |           |            |
+--------------------+-----------------------------+-----------+------------+
| DataManagement     | FTS3Agent                   | YES       |            |
+--------------------+-----------------------------+-----------+------------+
| Framework          | CAUpdateAgent               |           |            |
+                    +-----------------------------+-----------+------------+
|                    | MyProxyRenewalAgent         |           |            |
+--------------------+-----------------------------+-----------+------------+
| RequestManagement  | CleanReqDBAgent             | NO        |            |
+                    +-----------------------------+-----------+------------+
|                    | RequestExecutingAgent       | YES       |            |
+--------------------+-----------------------------+-----------+------------+
| ResourceStatus     | CacheFeederAgent            |           |            |
+                    +-----------------------------+-----------+------------+
|                    | ElementInspectorAgent       |           |            |
+                    +-----------------------------+-----------+------------+
|                    | EmailAgent                  | NO        |            |
+                    +-----------------------------+-----------+------------+
|                    | SiteInspectorAgent          |           |            |
+                    +-----------------------------+-----------+------------+
|                    | SummarizeLogsAgent          |           |            |
+                    +-----------------------------+-----------+------------+
|                    | TokenAgent                  |           |            |
+--------------------+-----------------------------+-----------+------------+
| StorageManagement  | RequestFinalizationAgent    | NO        |            |
+                    +-----------------------------+-----------+------------+
|                    | RequestPreparationAgent     | NO        |            |
+                    +-----------------------------+-----------+------------+
|                    | StageMonitorAgent           | NO        |            |
+                    +-----------------------------+-----------+------------+
|                    | StageRequestAgent           | NO        |            |
+--------------------+-----------------------------+-----------+------------+
| Transformation     | InputDataAgent              |           |            |
+                    +-----------------------------+-----------+------------+
|                    | MCExtensionAgent            |           |            |
+                    +-----------------------------+-----------+------------+
|                    | RequestTaskAgent            |           |            |
+                    +-----------------------------+-----------+------------+
|                    | TransformationAgent         |           |            |
+                    +-----------------------------+-----------+------------+
|                    | TransformationCleaningAgent |           |            |
+                    +-----------------------------+-----------+------------+
|                    | ValidateOutputDataAgent     |           |            |
+                    +-----------------------------+-----------+------------+
|                    | WorkflowTaskAgent           |           |            |
+--------------------+-----------------------------+-----------+------------+
| WorkloadManagement | DiracSiteAgent              |           |            |
+                    +-----------------------------+-----------+------------+
|                    | JobAgent                    |           |            |
+                    +-----------------------------+-----------+------------+
|                    | JobCleaningAgent            |           |            |
+                    +-----------------------------+-----------+------------+
|                    | PilotMonitorAgent           |           |            |
+                    +-----------------------------+-----------+------------+
|                    | PilotStatusAgent            |           |            |
+                    +-----------------------------+-----------+------------+
|                    | StalledJobAgent             |           |            |
+                    +-----------------------------+-----------+------------+
|                    | StatesAccountingAgent       |           |            |
+                    +-----------------------------+-----------+------------+
|                    | StatesMonitoringAgent       |           |            |
+--------------------+-----------------------------+-----------+------------+
